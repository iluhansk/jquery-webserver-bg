!function(t,r,i,n){var e="webserverBackground",a={data:function(){var r=t(this).data(e);return r&&r.target||t.error("webserverBackground not initialized"),r},option:function(){for(var t=a.data.call(this),r=0;r<arguments.length;r++)if(void 0===(t=t[arguments[r]]))return t;return t},pid:function(){return a.option.call(this,"private","pid")},delay:function(){return a.option.call(this,"check","delay")},online:function(){return a.option.call(this,"private","online")}},o={option:function(r){var i=t(this),n=a.data.call(this),o=n;if(!arguments.length)return!1;if(1==arguments.length)return i.data(e,r);for(var s=1;s<arguments.length-1;s++)void 0===o[arguments[s]]&&(o[arguments[s]]={}),o=o[arguments[s]];return o[arguments[arguments.length-1]]=r,i.data(e,n)},pid:function(t){var r=u.getField(t,"processId");o.option.call(this,r,"private","pid")},online:function(t){return o.option.call(this,t,"private","online")}},s={start:{data:function(){var t=a.option.call(this,"start","getData");return"function"==typeof t?t.call(this):{action:"start"}},settings:function(){var r=t(this),i=a.option.call(this,"start","ajax"),n=s.start.data.call(this);return n&&(i.data=n),i.url||(r.is("a")&&(i.url=r.attr("href")),r.is("form")&&(i.url=r.attr("action"))),r.is("form")&&(i.method=r.attr("method")),i.error=l.ajaxError,i.success=u.parse,i.complete=function(){},i.beforeSend||(i.beforeSend=f.block),i.context=this,i}},check:{data:function(){var t=a.option.call(this,"check","getData");return"function"==typeof t?t.call(this):{action:"check",pid:a.pid.call(this)}},settings:function(){var t=a.option.call(this,"check","ajax");if(!t.url){var r=s.start.settings.call(this);t.url=r.url}var i=s.check.data.call(this);return i&&(t.data=i),t.error=l.ajaxError,t.success=u.parse,t.complete=function(){},t.context=this,t}}},c={getContainer:function(){var r=a.option.call(this,"progress");if(r&&r.container){var i=t(this).find(r.container);return i.length>0?i:t(r.container).first()}return t([])},show:function(t){var r=a.option.call(this,"progress");r&&r.print&&r.print.call(this,t),c.getContainer.call(this).show()},hide:function(){c.getContainer.call(this).hide()}},l={isFunction:function(t){return t instanceof Function},checkStatus:function(){var r=s.check.settings.call(this);h.trigger.call(this,"beforeCheck"),t.ajax(r)},ajaxError:function(t,r,i){l.error.call(this,i)},error:function(t){h.trigger.call(this,"error");var r=a.option.call(this,"error","print");l.isFunction(r)&&r.call(this,t),l.complete.call(this)},success:function(){h.trigger.call(this,"success");var t=a.option.call(this,"success");l.isFunction(t)&&t.call(this),l.complete.call(this)},complete:function(){o.online.call(this,!1),h.trigger.call(this,"complete");var t=a.option.call(this,"complete");l.isFunction(t)&&t.call(this)}},u={getField:function(t,r,i){var n=a.option.call(this,"json","fields",r);if(n){var e=t[n];if(void 0!==e)return e}return i},getStatusType:function(t){var r=a.option.call(this,"json","statuses");for(var i in r)if(r.hasOwnProperty(i)&&t==r[i])return i;return!1},parse:function(t){var r=u.getField(t,"status"),i=u.getStatusType(r);if(i){var n=u.statuses[i];if(l.isFunction(n))return n.call(this,t)}l.error.call(this,"unknown status")},statuses:{ok:function(t){o.pid.call(this,t),c.show.call(this,{percent:0});var r=a.delay.call(this);setTimeout(l.checkStatus.bind(this),r)},done:function(t){l.success.call(this)},pending:function(t){c.show.call(this,t);var r=a.option.call(this,"check","delay");setTimeout(l.checkStatus.bind(this),r)},error:function(t){var r=u.getField(t,"message","unknown error");l.error.call(this,r)}}},h={trigger:function(r){var i=e+":"+r;t(this).trigger(i)}},f={init:function(r){return this.each(function(){var i=t(this),n=i.data(e);if(!n||!n.target){var a=t.extend(!0,t.fn.webserverBackground.options,r);a.target=i,i.data(e,a),i.is("form")&&i.submit(function(t){return t.preventDefault(),f.start.call(i),!1}),i.is("a")&&i.click(function(t){return t.preventDefault(),f.start.call(i),!1})}})},destroy:function(){return this.each(function(){var r=t(this);r.data(e);t(void 0).unbind("."+e),r.removeData(e)})},start:function(){return this.each(function(){if(a.online.call(this))return!1;o.online.call(this,!0),h.trigger.call(this,"start");var r=s.start.settings.call(this);t.ajax(r)})},block:function(){var r=t(this);r.is("form")&&r.find("select, input, textarea").attr("disabled","disabled")},unblock:function(){var r=t(this);r.is("form")&&r.find("select, input, textarea").attr("disabled",!1)}};t.fn.webserverBackground=function(r){return f[r]?f[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?void t.error("Method "+r+" not exist in jQuery.webserverBackground"):f.init.apply(this,arguments)},t.fn.webserverBackground.options={start:{ajax:{method:"POST",dataType:"json",beforeSend:function(){var t=a.option.call(this,"error","clear");l.isFunction(t)&&t.call(this)}},getData:function(){var r=t(this);return r.is("form")?r.serialize():{action:"start"}}},check:{ajax:{method:"POST",dataType:"json"},delay:1e3},error:{container:".error",template:'<div class="error"></div>',print:function(r){var i=t(this);if(i.is("form")){var n=a.option.call(i,"error","container"),e=i.find(n).first();if(!e.length){var o=a.option.call(i,"error","template");i.append(o),e=i.find(n).first()}e.length&&e.html(r)}},clear:function(){var r=t(this),i=a.option.call(r,"error","print");l.isFunction(i)&&i.call(this,"")}},success:function(){},complete:function(){c.hide.call(this),f.unblock.call(this)},progress:{container:".progressContainer",template:'<div class="progress progress-striped active"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%"><span class="complition">0</span>%</div></div>',print:function(t){var r=u.getField(t,"percent"),i=c.getContainer.call(this);if(i.length){if(!i.find(".progress").length){var n=a.option.call(this,"progress","template");i.html(n)}i.find(".progress-bar").attr("aria-valuenow",r).attr("style","width:"+r+"%"),i.find(".complition").html(r)}}},json:{fields:{status:"status",message:"message",processId:"pid",progress:"procent"},statuses:{ok:"ok",done:"done",error:"error",pending:"pending"}}}}(jQuery);